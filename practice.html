<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sentence Trainer — Practice</title>
  <link rel="icon" href="data:;base64,=">
  <style>
    :root{
      --bg:#0f1216; --card:#151A21; --muted:#9aa6b8; --text:#e6e9ee;
      --accent:#6ee7ff; --accent-2:#b794f4; --good:#34d399; --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
         color:var(--text);background:radial-gradient(1200px 800px at 10% -20%,#1b2230 0%,#0f1216 55%) fixed;}
    .wrap{max-width:960px;margin:6vh auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    h1{font-size:clamp(20px,3vw,28px);margin:0;font-weight:700}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid #273041;border-radius:999px;padding:8px 12px;color:var(--muted);font-size:13px}
    .card{background:linear-gradient(180deg,#161C24,#12161C);border:1px solid #212837;border-radius:var(--radius);
          box-shadow:0 10px 30px rgba(0,0,0,.35);padding:22px}
    .board{background:#0d1218;border:1px solid #222a36;border-radius:16px;padding:22px;min-height:180px;display:flex;align-items:center;justify-content:center;text-align:center}
    .prompt{font-size:clamp(20px,3vw,28px);font-weight:700;letter-spacing:.2px}
    .translation{margin-top:12px;color:var(--muted);font-size:clamp(16px,2.4vw,20px)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    button{appearance:none;border:1px solid #2a3240;color:var(--text);background:#0f141a;border-radius:14px;
           padding:12px 16px;font-weight:700;cursor:pointer;transition:transform .04s ease, border-color .2s ease, background .2s ease}
    button.primary{background:linear-gradient(180deg,#1d2430,#141a22);border-color:#2e3a4a}
    button:hover{transform:translateY(-1px)}
    .meta{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;color:var(--muted);font-size:13px}
    .link{color:var(--accent);text-decoration:none}
    .spacer{flex:1}
    .tiny{font-size:12px;color:#8291a6}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="title">Sentence Trainer</h1>
      <span class="pill" id="progress">0 / 0</span>
    </header>

    <div class="card">
      <div class="controls">
        <button id="new_en" class="primary">Show English</button>
        <button id="new_tl" class="primary">Show Target Language</button>
        <button id="reveal">Reveal Translation</button>
        <div class="spacer"></div>
        <button id="undo">Undo</button>
        <button id="reset">Reset cycle</button>
      </div>

      <div class="board" style="margin-top:16px">
        <div>
          <div class="prompt" id="prompt">Choose a side to begin ↑</div>
          <div class="translation" id="answer" style="display:none"></div>
        </div>
      </div>

      <div class="meta">
        <span id="langBadge"></span>
        <span class="spacer"></span>
        <a class="link" href="index.html">← Back to input</a>
      </div>
      <div class="tiny" style="margin-top:8px">Tip: it won’t repeat items until every pair has appeared once.</div>
    </div>
  </div>

<script>
(function(){
  const data = JSON.parse(localStorage.getItem('trainer_dataset') || 'null');
  const title = document.getElementById('title');
  const langBadge = document.getElementById('langBadge');
  const progressEl = document.getElementById('progress');
  const promptEl = document.getElementById('prompt');
  const answerEl = document.getElementById('answer');
  const btnEN = document.getElementById('new_en');
  const btnTL = document.getElementById('new_tl');
  const btnReveal = document.getElementById('reveal');
  const btnReset = document.getElementById('reset');
  const btnUndo = document.getElementById('undo');

  if(!data || !Array.isArray(data.items) || !data.items.length){
    promptEl.textContent = 'No data found. Go back and paste some pairs.';
    document.getElementById('answer').style.display = 'none';
  }

  const items = data?.items ?? [];
  const langName = (data?.langName ?? 'Target Language').trim() || 'Target Language';
  title.textContent = `Sentence Trainer — ${langName}`;
  langBadge.textContent = `Dataset: ${langName} (${items.length} pairs)`;

  let poolEN = [...items.keys()]; // indices remaining for EN prompts
  let poolTL = [...items.keys()]; // indices remaining for TL prompts
  let seen = 0;
  let last = null; // { idx, side: 'en'|'tl' }
  updateProgress();

  function updateProgress(){
    // progress is min of two pools used? Show combined unique exposures
    const total = items.length * 2; // both directions possible
    const used = (items.length - poolEN.length) + (items.length - poolTL.length);
    progressEl.textContent = `${used} / ${total}`;
  }

  function pick(pool){
    if (pool.length === 0) return null;
    const k = Math.floor(Math.random() * pool.length);
    const idx = pool.splice(k,1)[0];
    return idx;
  }

  function showPrompt(side){
    answerEl.style.display = 'none';
    // refill pool if empty
    if (side === 'en' && poolEN.length === 0) poolEN = [...items.keys()];
    if (side === 'tl' && poolTL.length === 0) poolTL = [...items.keys()];

    const pool = (side === 'en') ? poolEN : poolTL;
    const idx = pick(pool);
    if (idx === null){
      promptEl.textContent = 'Out of items — reset the cycle.';
      return;
    }
    const pair = items[idx];
    if (side === 'en'){
      promptEl.textContent = pair.en;
      answerEl.textContent = pair.tl;
    } else {
      promptEl.textContent = pair.tl;
      answerEl.textContent = pair.en;
    }
    last = { idx, side };
    updateProgress();
  }

  function reveal(){
    if (!answerEl.textContent){
      return;
    }
    answerEl.style.display = '';
  }

  function resetCycle(){
    poolEN = [...items.keys()];
    poolTL = [...items.keys()];
    last = null;
    answerEl.style.display = 'none';
    promptEl.textContent = 'Cycle reset. Choose a side to begin ↑';
    answerEl.textContent = '';
    updateProgress();
  }

  function undoLast(){
    if (!last) return;
    const { idx, side } = last;
    // put back the index into the corresponding pool (so it can appear again)
    const pool = side === 'en' ? poolEN : poolTL;
    if (!pool.includes(idx)) pool.push(idx);
    last = null;
    updateProgress();
    answerEl.style.display = 'none';
    promptEl.textContent = 'Undone. Choose again ↑';
    answerEl.textContent = '';
  }

  btnEN.addEventListener('click', ()=>showPrompt('en'));
  btnTL.addEventListener('click', ()=>showPrompt('tl'));
  btnReveal.addEventListener('click', reveal);
  btnReset.addEventListener('click', resetCycle);
  btnUndo.addEventListener('click', undoLast);

  // Keyboard: E for English, T for Target, Space for Reveal, R reset
  window.addEventListener('keydown', (e)=>{
    if (e.key.toLowerCase() === 'e') showPrompt('en');
    if (e.key.toLowerCase() === 't') showPrompt('tl');
    if (e.key === ' ') { e.preventDefault(); reveal(); }
    if (e.key.toLowerCase() === 'r') resetCycle();
    if (e.key.toLowerCase() === 'z' && (e.ctrlKey || e.metaKey)) undoLast();
  });
})();
</script>
</body>
</html>
