<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sentence Trainer ‚Äî Practice</title>
  <link rel="icon" href="data:;base64,=">
  <style>
    :root{
      --bg:#0f1216; --bg2:#1b2230; --card:#151A21; --muted:#9aa6b8; --text:#e6e9ee;
      --accent:#66eadf; --accent-2:#b794f4; --good:#34d399; --radius:18px;
      --btnText:#0b1b19;
    }

    /* THEMES */
    body.theme-sleek{
      background:radial-gradient(1200px 800px at 10% -20%,var(--bg2) 0%,var(--bg) 55%) fixed;
      color:var(--text);
    }
    body.theme-playful{
      background: linear-gradient(135deg,#0b1324 0%, #101a36 50%, #0b1324 100%);
    }
    body.theme-exam{
      background:#0b0d11;
    }

    *{box-sizing:border-box}
    body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:960px;margin:6vh auto;padding:24px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap}
    h1{font-size:clamp(20px,3vw,28px);margin:0;font-weight:700}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid #273041;border-radius:999px;padding:8px 12px;color:var(--muted);font-size:13px}
    .card{background:linear-gradient(180deg,#161C24,#12161C);border:1px solid #212837;border-radius:var(--radius);
          box-shadow:0 10px 30px rgba(0,0,0,.35);padding:22px}

    /* BIGGER BUTTONS (light teal) */
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:2px}
    button{
      appearance:none;border:1px solid #2a3240;color:var(--btnText);
      background:linear-gradient(180deg,#9af3ea,#66eadf);
      border-radius:14px;padding:14px 18px;font-weight:800;cursor:pointer;font-size:16px;
      transition:transform .04s ease, filter .2s ease, opacity .2s ease
    }
    button.primary{filter:saturate(1.05)}
    button:hover{transform:translateY(-1px);filter:brightness(1.05)}
    button.ghost{background:#0f141a;color:#e6e9ee;border-color:#2a3240}

    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select, .toggle{
      background:#0f141a;border:1px solid #2a3240;border-radius:12px;color:#e6e9ee;padding:10px 12px;font-weight:600
    }

    /* BOARD */
    .board{background:#0d1218;border:1px solid #222a36;border-radius:16px;padding:28px;min-height:220px;
           display:flex;align-items:center;justify-content:center;text-align:center;overflow:hidden}
   /* Always-visible by default */
.prompt{
  font-size:clamp(32px,6vw,64px);
  font-weight:800;
  letter-spacing:.4px;
  line-height:1.35;
  opacity:1; /* was 0 */
  transform:none; /* was translateY(...) */
}

.translation{
  margin-top:18px;
  color:#b6c4d6;
  font-size:clamp(28px,5vw,48px);
  line-height:1.35;
  opacity:1; /* was 0 */
  transform:none; /* was translateY(...) */
  display:none;   /* stays hidden until Reveal */
}

/* Optional animation class (applied by JS); text is visible even if this doesn't run */
.fx-in { animation: fadeSlide .35s ease; }
.fx-out { animation: fadeOut .2s ease; }

@keyframes fadeSlide {
  from { opacity:0; transform:translateY(8px); }
  to   { opacity:1; transform:translateY(0); }
}
@keyframes fadeOut {
  to { opacity:0; transform:translateY(-6px); }
}
    /* ANIMATIONS */
    @keyframes fadeSlide{
      to{ opacity:1; transform:translateY(0); }
    }
    .out{ animation:fadeOut .2s ease forwards; }
    @keyframes fadeOut{ to{opacity:0; transform:translateY(-6px);} }

    .meta{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;color:#9aa6b8;font-size:13px}
    .spacer{flex:1}
    .tiny{font-size:12px;color:#8291a6}
    a{color:#66eadf;text-decoration:none}
  </style>
</head>
<body class="theme-sleek">
  <div class="wrap">
    <header>
      <div class="toolbar">
        <h1 id="title" style="margin-right:6px">Sentence Trainer</h1>
        <span class="pill" id="progress">0 / 0</span>
      </div>
      <div class="toolbar">
        <label class="tiny" style="margin-right:6px">Theme</label>
        <select id="theme">
          <option value="sleek">Sleek</option>
          <option value="playful">Playful</option>
          <option value="exam">Exam-Mode</option>
        </select>
        <label class="tiny" style="margin-left:8px;margin-right:6px">Font size</label>
        <select id="fontsize">
          <option value="normal">Normal</option>
          <option value="large">Large (IWB)</option>
          <option value="xl">XL (Hall)</option>
        </select>
      </div>
    </header>

    <div class="card">
      <div class="controls">
        <button id="new_en" class="primary">Show English</button>
        <button id="new_tl" class="primary">Show Target Language</button>
        <button id="reveal">Reveal</button>
        <button id="speak" title="Speak target sentence">üîä Speak</button>
        <div class="spacer"></div>
        <button id="undo" class="ghost">Undo</button>
        <button id="reset" class="ghost">Reset</button>
      </div>

      <div class="board" style="margin-top:16px">
        <div>
          <div class="prompt" id="prompt">Choose a side to begin ‚Üë</div>
          <div class="translation" id="answer" style="display:none"></div>
        </div>
      </div>

      <div class="meta">
        <span id="langBadge"></span>
        <span class="spacer"></span>
        <a href="index.html">‚Üê Back to input</a>
      </div>
      <div class="tiny" style="margin-top:8px">
        Tips: Space = Reveal ¬∑ E = English ¬∑ T = Target ¬∑ R = Reset ¬∑ ‚åò/Ctrl+Z = Undo
      </div>
    </div>
  </div>

<script>
(function(){
  // ===== LOAD DATA =====
  const data = JSON.parse(localStorage.getItem('trainer_dataset') || 'null');
  const items = data?.items ?? [];
  const langName = (data?.langName ?? 'Target Language').trim() || 'Target Language';
  const langCode = (data?.langCode ?? '').trim(); // e.g., 'de-DE'

  // ===== UI ELEMENTS =====
  const title = document.getElementById('title');
  const langBadge = document.getElementById('langBadge');
  const progressEl = document.getElementById('progress');
  const promptEl = document.getElementById('prompt');
  const answerEl = document.getElementById('answer');
  const btnEN = document.getElementById('new_en');
  const btnTL = document.getElementById('new_tl');
  const btnReveal = document.getElementById('reveal');
  const btnReset = document.getElementById('reset');
  const btnUndo = document.getElementById('undo');
  const btnSpeak = document.getElementById('speak');
  const themeSel = document.getElementById('theme');
  const fontSel = document.getElementById('fontsize');

  // page title + badge
  title.textContent = `Sentence Trainer ‚Äî ${langName}`;
  langBadge.textContent = `Dataset: ${langName} (${items.length} pairs${langCode ? ', TTS '+langCode : ''})`;

  if(!items.length){
    promptEl.textContent = 'No data found. Go back and paste some pairs.';
    answerEl.style.display = 'none';
  }

  // ===== STATE =====
  let poolEN = [...items.keys()];
  let poolTL = [...items.keys()];
  let last = null; // { idx, side: 'en'|'tl' }
  updateProgress();

  // ===== PROGRESS =====
  function updateProgress(){
    const total = items.length * 2;
    const used = (items.length - poolEN.length) + (items.length - poolTL.length);
    progressEl.textContent = `${used} / ${total}`;
  }

  function pick(pool){ if(!pool.length) return null; return pool.splice(Math.floor(Math.random()*pool.length),1)[0]; }

 function setAnimatedText(el, text){
  // animate out (non-blocking; if animations are disabled, text remains visible)
  el.classList.remove('fx-in');
  el.classList.add('fx-out');

  setTimeout(()=>{
    const newEl = el.cloneNode(true);
    newEl.textContent = text;

    // ensure visibility even if animations are disabled
    newEl.style.opacity = '1';
    newEl.style.transform = 'none';

    // add optional entrance animation class
    newEl.classList.remove('fx-out');
    newEl.classList.add('fx-in');

    el.parentNode.replaceChild(newEl, el);
    if (newEl.id === 'prompt') promptElRef = newEl;
    if (newEl.id === 'answer') answerElRef = newEl;
  }, 160);
}


  // ===== PROMPTS =====
  function showPrompt(side){
    answerElRef.style.display = 'none';
    // refill if empty
    if(side==='en' && poolEN.length===0) poolEN = [...items.keys()];
    if(side==='tl' && poolTL.length===0) poolTL = [...items.keys()];

    const pool = side==='en' ? poolEN : poolTL;
    const idx = pick(pool);
    if (idx===null){
      setAnimatedText(promptElRef, 'Out of items ‚Äî reset the cycle.');
      answerElRef.textContent = '';
      return;
    }
    const pair = items[idx];
    if (side==='en'){
      setAnimatedText(promptElRef, pair.en);
      answerElRef.textContent = pair.tl;
    } else {
      setAnimatedText(promptElRef, pair.tl);
      answerElRef.textContent = pair.en;
      // optional: auto-speak TL when showing TL prompt
      speakText(pair.tl);
    }
    last = { idx, side };
    updateProgress();
  }

  function reveal(){
    if (!answerElRef.textContent) return;
    answerElRef.style.display = '';
newAns.style.opacity = '1';
newAns.style.transform = 'none';
newAns.classList.add('fx-in');
    // trigger small fade for answer
    const newAns = answerElRef.cloneNode(true);
    newAns.style.display = '';
    answerElRef.parentNode.replaceChild(newAns, answerElRef);
    answerElRef = newAns;
  }

  function resetCycle(){
    poolEN = [...items.keys()];
    poolTL = [...items.keys()];
    last = null;
    answerElRef.style.display = 'none';
    setAnimatedText(promptElRef, 'Cycle reset. Choose a side to begin ‚Üë');
    answerElRef.textContent = '';
    updateProgress();
  }

  function undoLast(){
    if(!last) return;
    const { idx, side } = last;
    const pool = side==='en'?poolEN:poolTL;
    if(!pool.includes(idx)) pool.push(idx);
    last = null;
    answerElRef.style.display = 'none';
    setAnimatedText(promptElRef, 'Undone. Choose again ‚Üë');
    answerElRef.textContent = '';
    updateProgress();
  }

  btnEN.addEventListener('click', ()=>showPrompt('en'));
  btnTL.addEventListener('click', ()=>showPrompt('tl'));
  btnReveal.addEventListener('click', reveal);
  btnReset.addEventListener('click', resetCycle);
  btnUndo.addEventListener('click', undoLast);

  // ===== KEYBOARD SHORTCUTS =====
  window.addEventListener('keydown', (e)=>{
    if (e.key.toLowerCase()==='e') showPrompt('en');
    if (e.key.toLowerCase()==='t') showPrompt('tl');
    if (e.key===' ') { e.preventDefault(); reveal(); }
    if (e.key.toLowerCase()==='r') resetCycle();
    if (e.key.toLowerCase()==='z' && (e.ctrlKey || e.metaKey)) undoLast();
  });

  // ===== THEMES =====
  function applyTheme(name){
    document.body.classList.remove('theme-sleek','theme-playful','theme-exam');
    document.body.classList.add('theme-'+name);
    localStorage.setItem('trainer_theme', name);
  }
  themeSel.value = localStorage.getItem('trainer_theme') || 'sleek';
  applyTheme(themeSel.value);
  themeSel.addEventListener('change', ()=>applyTheme(themeSel.value));

  // ===== FONT SIZE PRESETS =====
  function applyFontPreset(preset){
    const root = document.documentElement;
    if (preset==='normal'){
      root.style.setProperty('--prompt-min','32px');
      root.style.setProperty('--prompt-max','64px');
      root.style.setProperty('--ans-min','28px');
      root.style.setProperty('--ans-max','48px');
    } else if (preset==='large'){
      root.style.setProperty('--prompt-min','40px');
      root.style.setProperty('--prompt-max','84px');
      root.style.setProperty('--ans-min','34px');
      root.style.setProperty('--ans-max','64px');
    } else { // xl
      root.style.setProperty('--prompt-min','56px');
      root.style.setProperty('--prompt-max','112px');
      root.style.setProperty('--ans-min','44px');
      root.style.setProperty('--ans-max','84px');
    }
    // update CSS clamp via inline style on elements
    promptElRef.style.fontSize = `clamp(var(--prompt-min),6vw,var(--prompt-max))`;
    answerElRef.style.fontSize = `clamp(var(--ans-min),5vw,var(--ans-max))`;
    localStorage.setItem('trainer_font', preset);
  }
  // initialize custom properties
  applyFontPreset(localStorage.getItem('trainer_font') || 'large');
  fontSel.value = localStorage.getItem('trainer_font') || 'large';
  fontSel.addEventListener('change', ()=>applyFontPreset(fontSel.value));

  // ===== TEXT TO SPEECH =====
  let ttsVoice = null;
  function pickVoice(){
    const voices = speechSynthesis.getVoices();
    if (!voices.length) return null;
    if (langCode){
      // prefer exact match, then same language
      const exact = voices.find(v=>v.lang.toLowerCase()===langCode.toLowerCase());
      if (exact) return exact;
      const base = langCode.split('-')[0].toLowerCase();
      const fallback = voices.find(v=>v.lang.toLowerCase().startsWith(base));
      if (fallback) return fallback;
    }
    // otherwise pick a reasonable default non-English if available, else first
    const nonEn = voices.find(v=>!/^en/i.test(v.lang));
    return nonEn || voices[0];
  }
  function speakText(text){
    if (!text || !('speechSynthesis' in window)) return;
    // stop any ongoing
    window.speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    if (!ttsVoice) ttsVoice = pickVoice();
    if (ttsVoice) utter.voice = ttsVoice;
    if (langCode) utter.lang = langCode;
    utter.rate = 1.0; // adjust if needed
    utter.pitch = 1.0;
    window.speechSynthesis.speak(utter);
  }
  // some browsers load voices async
  if ('speechSynthesis' in window){
    speechSynthesis.onvoiceschanged = ()=>{ ttsVoice = pickVoice(); };
  }

  btnSpeak.addEventListener('click', ()=>{
    // speak the TL if visible in prompt; if English is shown, speak the TL answer so they can hear the target
    if (!last){ return; }
    const pair = items[last.idx];
    const toSpeak = (last.side==='tl') ? pair.tl : pair.tl; // always target language
    speakText(toSpeak);
  });
})();
</script>
</body>
</html>
